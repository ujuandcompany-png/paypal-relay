<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PayPal SDK with brand_name -->
  <script src="https://www.paypal.com/sdk/js?client-id=sb&currency=USD&intent=capture&commit=true&enable-funding=card&merchant-id=*"
          data-namespace="paypal_sdk"
          data-brand-name="uju & Co.">
  </script>

  <title>uju & Co. PayPal Checkout</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .status-bubble {
      position: fixed;
      bottom: 25px;
      right: 25px;
      background: #28a745;
      color: white;
      padding: 12px 22px;
      border-radius: 999px;
      font-size: 16px;
      font-weight: bold;
      opacity: 0;
      transition: opacity 0.4s ease;
      pointer-events: none;
      z-index: 9999;
    }
  </style>
</head>

<body>
  <h2>uju & Co. PayPal Checkout</h2>
  <div id="paypal-button-container"></div>
  <div id="statusBubble" class="status-bubble">PayPal Cart Updated âœ“</div>

  <script>
    // Show green success pill
    function showStatusBubble() {
      const b = document.getElementById("statusBubble");
      b.style.opacity = 1;
      setTimeout(() => b.style.opacity = 0, 1800);
    }

    // Read product details passed from Google Sites
    const urlParams = new URLSearchParams(window.location.search);

    const itemName  = urlParams.get("item_name") || "Unknown Item";
    const itemPrice = parseFloat(urlParams.get("amount") || "0").toFixed(2);
    const quantity  = parseInt(urlParams.get("quantity") || "1");
    const hostedId  = urlParams.get("hosted_button_id") || "";
    const optionName  = urlParams.get("on0") || null;
    const optionValue = urlParams.get("os0") || null;

    // For debugging
    console.log("Relay received:", {
      itemName, itemPrice, quantity, hostedId, optionName, optionValue
    });

    paypal_sdk.Buttons({
      style: {
        color: "gold",
        shape: "rect",
        label: "checkout"
      },

      createOrder: function(data, actions) {
        showStatusBubble();

        let item = {
          name: itemName,
          unit_amount: {
            currency_code: "USD",
            value: itemPrice
          },
          quantity: quantity
        };

        if (optionName && optionValue) {
          item.description = `${optionName}: ${optionValue}`;
        }

        return actions.order.create({
          purchase_units: [{
            amount: {
              currency_code: "USD",
              value: (itemPrice * quantity).toFixed(2),
              breakdown: {
                item_total: {
                  currency_code: "USD",
                  value: (itemPrice * quantity).toFixed(2)
                }
              }
            },
            items: [item]
          }],
          application_context: {
            brand_name: "uju & Co.",
            user_action: "PAY_NOW"
          }
        });
      },

      onApprove: function(data, actions) {
        return actions.order.capture().then(function(orderData) {
          alert("Payment completed!");
        });
      },

      onError: function(err) {
        console.error("PayPal error:", err);
        alert("Something went wrong with PayPal.");
      }

    }).render("#paypal-button-container");
  </script>

</body>
</html>
