<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>uju & Co. PayPal Cart Checkout</title>
<link href="https://fonts.googleapis.com/css2?family=Dosis&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Dosis', sans-serif; margin: 20px; }
  #cartSummary { margin-bottom: 20px; border: 1px dashed #ccc; padding: 10px; width: 300px; }
  #cartSummary div { display: grid; grid-template-columns: 1fr auto; padding: 4px 0; }
  #cartSummary div.total-row { font-weight: bold; }
  #paypal-buttons-container { margin-top: 20px; }
  h2 { line-height: 1.2; }
</style>
</head>
<body>
<h2>uju & Co.<br><br><span>PayPal Cart Checkout</span></h2>
<div id="cartSummary">Cart will display here</div>
<div id="paypal-buttons-container"></div>

<script>
// Read cart items from URL parameters using '|' separator
function getCartFromURL() {
  const params = new URLSearchParams(window.location.search);
  const items = [];
  for (const [key, value] of params.entries()) {
    if (key.startsWith('item')) {
      const parts = value.split('|'); // name|qty|price
      if(parts.length >= 3){
        items.push({
          name: decodeURIComponent(parts[0]),
          qty: Number(parts[1]),
          price: Number(parts[2])
        });
      }
    }
  }
  return items;
}

const cartItems = getCartFromURL();

function renderCart(items){
  const container = document.getElementById('cartSummary');
  let total = 0;
  let html = '';
  items.forEach(it => {
    const line = it.qty * it.price;
    total += line;
    html += `<div><span>$${it.price.toFixed(2)} - ${it.name} x ${it.qty}</span><span>$${line.toFixed(2)}</span></div>`;
  });
  html += `<div class='total-row'><span></span><span>Total: $${total.toFixed(2)}</span></div>`;
  container.innerHTML = html;
  return total;
}

const total = renderCart(cartItems);

// Load PayPal SDK with your live client ID
const script = document.createElement('script');
script.src = 'https://www.paypal.com/sdk/js?client-id=AYMMP5tG5xhXOMwg9VwtF2SNXhO1txVUk2USwhWO9lcyrUAMwZbdKQSqj2ZwfIUUa44RaHxxrWryePnD&currency=USD';
document.body.appendChild(script);

script.onload = () => {
  paypal.Buttons({
    style: { layout: 'horizontal', shape:'rect' },
    createOrder: (data, actions) => {
      return actions.order.create({
        purchase_units: [{
          amount: { value: total.toFixed(2) },
          items: cartItems.map(it => ({
            name: it.name,
            unit_amount: { currency_code: 'USD', value: it.price.toFixed(2) },
            quantity: it.qty
          }))
        }],
        application_context: {
          brand_name: 'uju & Co.',
          user_action: 'PAY_NOW',
          shipping_preference: 'NO_SHIPPING'
        }
      });
    },
    onApprove: (data, actions) => {
      return actions.order.capture().then(details => {
        alert('Transaction completed by ' + details.payer.name.given_name + '!');
      });
    }
  }).render('#paypal-buttons-container');
};
</script>
</body>
</html>
