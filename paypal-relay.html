<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PayPal Checkout - uju & Co.</title>
<style>
  body { font-family: 'Dosis', sans-serif; padding: 20px; background: #f9f9f9; }
  h2 { text-align: center; margin-bottom: 20px; }
  #cartSummary { max-width: 600px; margin: 0 auto 30px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
  .cartRow { display: flex; justify-content: space-between; margin-bottom: 8px; }
  .totalRow { font-weight: bold; border-top: 1px solid #ccc; padding-top: 8px; }
  #paypal-buttons-container { display: flex; justify-content: center; margin-top: 20px; }
</style>
</head>
<body>

<h2>uju & Co. Checkout</h2>
<div id="cartSummary"></div>
<div id="paypal-buttons-container"></div>

<!-- PayPal SDK with card funding enabled -->
<script src="https://www.paypal.com/sdk/js?client-id=AYMMP5tG5xhXOMwg9VwtF2SNXhO1txVUk2USwhWO9lcyrUAMwZbdKQSqj2ZwfIUUa44RaHxxrWryePnD&currency=USD&intent=CAPTURE&enable-funding=card"></script>

<script>
// Parse items from URL query parameters
const params = new URLSearchParams(window.location.search);
const cartItems = {};
let totalAmount = 0;

for (const [key, value] of params.entries()) {
    const [name, qty, price] = key.split('|');
    const quantity = parseInt(qty);
    const unitPrice = parseFloat(price);
    if (!cartItems[name]) cartItems[name] = { qty: 0, price: unitPrice };
    cartItems[name].qty += quantity;
    totalAmount += unitPrice * quantity;
}

// Render cart summary
const container = document.getElementById('cartSummary');
let html = '';
for (const name in cartItems) {
    const item = cartItems[name];
    const lineTotal = item.qty * item.price;
    html += `<div class="cartRow"><span>${name} x ${item.qty}</span><span>$${lineTotal.toFixed(2)}</span></div>`;
}
html += `<div class="cartRow totalRow"><span>Total</span><span>$${totalAmount.toFixed(2)}</span></div>`;
container.innerHTML = html;

// Render PayPal Buttons
paypal.Buttons({
    style: { layout: 'vertical', color: 'gold', shape: 'rect', label: 'pay' },
    createOrder: function(data, actions) {
        const itemsArr = [];
        for (const name in cartItems) {
            const item = cartItems[name];
            itemsArr.push({
                name: name,
                unit_amount: { currency_code: "USD", value: item.price.toFixed(2) },
                quantity: item.qty
            });
        }
        return actions.order.create({
            purchase_units: [{
                amount: {
                    currency_code: "USD",
                    value: totalAmount.toFixed(2),
                    breakdown: { item_total: { currency_code: "USD", value: totalAmount.toFixed(2) } }
                },
                items: itemsArr
            }],
            application_context: {
                brand_name: "uju & Co.",
                user_action: "PAY_NOW",
                shipping_preference: "NO_SHIPPING"
            }
        });
    },
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
            alert("Transaction completed by " + details.payer.name.given_name + "!");
        });
    },
    onError: function(err) {
        console.error(err);
        alert("An error occurred with PayPal Checkout. Please try again.");
    }
}).render('#paypal-buttons-container');
</script>

</body>
</html>
