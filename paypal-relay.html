
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>uju & Co. PayPal Checkout</title>
<script src="https://www.paypal.com/sdk/js?client-id=AYMMP5tG5xhXOMwg9VwtF2SNXhO1txVUk2USwhWO9lcyrUAMwZbdKQSqj2ZwfIUUa44RaHxxrWryePnD&currency=USD"></script>
<style>
body { font-family: 'Dosis', sans-serif; padding: 20px; background: #f9f9f9; }
h1 { text-align:center; margin-bottom: 20px; }
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background:white; }
th, td { padding: 12px; border: 1px solid #ccc; text-align:left; }
th { background: #493b31; color: white; }
tfoot td { font-weight: bold; }
.paypal-buttons-container { text-align: center; }
</style>
</head>
<body>
<h1>uju & Co. PayPal Checkout</h1>
<table id="cartTable">
  <thead>
    <tr>
      <th>Product</th>
      <th>Color</th>
      <th>Qty</th>
      <th>Unit Price</th>
      <th>Total</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
  <tfoot>
    <tr>
      <td colspan="4">Total</td>
      <td id="grandTotal">$0.00</td>
    </tr>
  </tfoot>
</table>

<div class="paypal-buttons-container" id="paypalButtons"></div>

<script>
// Read query string items from Google Sites
function getCartItems() {
  const params = new URLSearchParams(window.location.search);
  const items = {};
  for (const [key, value] of params.entries()) {
    const match = key.match(/^item_name$/);
    if (match) {
      // key-value pairs: item_name, os0, quantity, amount
      const name = params.get('item_name');
      const color = params.get('os0');
      const quantity = parseInt(params.get('quantity')) || 1;
      const amount = parseFloat(params.get('amount')) || 0;
      const id = name + '||' + color;
      if (!items[id]) items[id] = {name, color, quantity, amount};
      else items[id].quantity += quantity; // sum same color
    }
  }
  return items;
}

// Render table
function renderCart() {
  const items = getCartItems();
  const tbody = document.querySelector('#cartTable tbody');
  tbody.innerHTML = '';
  let grandTotal = 0;
  for (const key in items) {
    const item = items[key];
    const total = item.quantity * item.amount;
    grandTotal += total;
    const row = document.createElement('tr');
    row.innerHTML = `<td>${item.name}</td><td>${item.color}</td><td>${item.quantity}</td><td>$${item.amount.toFixed(2)}</td><td>$${total.toFixed(2)}</td>`;
    tbody.appendChild(row);
  }
  document.getElementById('grandTotal').innerText = `$${grandTotal.toFixed(2)}`;
  return Object.values(items);
}

const cartItems = renderCart();

// Create PayPal Order
paypal.Buttons({
  style: { layout: 'vertical', color: 'gold', shape: 'rect', label: 'paypal' },
  createOrder: function(data, actions) {
    return actions.order.create({
      purchase_units: [{
        amount: {
          currency_code: 'USD',
          value: cartItems.reduce((sum,i)=>sum+i.quantity*i.amount,0).toFixed(2),
          breakdown: {
            item_total: {
              currency_code: 'USD',
              value: cartItems.reduce((sum,i)=>sum+i.quantity*i.amount,0).toFixed(2)
            }
          }
        },
        items: cartItems.map(i=>({
          name: i.name + ' â€“ ' + i.color,
          unit_amount: { currency_code: 'USD', value: i.amount.toFixed(2) },
          quantity: i.quantity.toString()
        }))
      }],
      application_context: {
        brand_name: "uju & Co.",
        shipping_preference: "NO_SHIPPING"
      }
    });
  },
  onApprove: function(data, actions) {
    return actions.order.capture().then(function(details) {
      alert('Transaction completed by ' + details.payer.name.given_name + '!');
    });
  }
}).render('#paypalButtons');
</script>
</body>
</html>
