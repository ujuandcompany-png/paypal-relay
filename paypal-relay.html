<table id="cartTable" style="width:100%; border-collapse:collapse; margin-top:20px; font-family:'Dosis'; font-size:16px;">
  <thead>
    <tr>
      <th>Item</th>
      <th>Variant</th>
      <th>Qty</th>
      <th>Unit Price</th>
      <th>Total</th>
      <th>Remove</th>
    </tr>
  </thead>
  <tbody></tbody>
  <tfoot>
    <tr>
      <td colspan="4">Grand Total</td>
      <td id="grandTotal">$0</td>
      <td></td>
    </tr>
  </tfoot>
</table>

<script>
function loadCart() {
  const params = new URLSearchParams(window.location.search);
  let cart = {};
  if(params.has('cart')) {
    try { cart = JSON.parse(decodeURIComponent(params.get('cart'))); } catch(e){ console.error(e);}
  }
  localStorage.setItem('paypalCart', JSON.stringify(cart));
  renderCart();
}

function renderCart() {
  const tbody = document.querySelector('#cartTable tbody');
  tbody.innerHTML = '';
  let cart = JSON.parse(localStorage.getItem('paypalCart') || '{}');
  let grandTotal = 0;
  for(const key in cart){
    const item = cart[key];
    const total = item.qty * item.price;
    grandTotal += total;
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.name}</td>
      <td>${item.variant || ''}</td>
      <td>
        <button onclick="adjustQty('${key}',-1)">âˆ’</button>
        <span style="margin:0 6px">${item.qty}</span>
        <button onclick="adjustQty('${key}',1)">+</button>
      </td>
      <td>$${item.price.toFixed(2)}</td>
      <td>$${total.toFixed(2)}</td>
      <td><button onclick="removeItem('${key}')">x</button></td>
    `;
    tbody.appendChild(tr);
  }
  document.getElementById('grandTotal').innerText = '$' + grandTotal.toFixed(2);
}

function adjustQty(key, change){
  let cart = JSON.parse(localStorage.getItem('paypalCart') || '{}');
  if(cart[key]){
    cart[key].qty += change;
    if(cart[key].qty <=0) delete cart[key];
  }
  localStorage.setItem('paypalCart', JSON.stringify(cart));
  renderCart();
}

function removeItem(key){
  let cart = JSON.parse(localStorage.getItem('paypalCart') || '{}');
  delete cart[key];
  localStorage.setItem('paypalCart', JSON.stringify(cart));
  renderCart();
}

window.addEventListener('load', loadCart);
</script>
