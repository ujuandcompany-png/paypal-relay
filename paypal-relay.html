<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>uju & Co. PayPal Checkout</title>
<style>
  body { font-family: 'Dosis', sans-serif; margin: 20px; background: #fafafa; }
  h2 { text-align: center; margin-bottom: 20px; }
  #cartSummary { max-width: 500px; margin: 0 auto 20px; background:white; padding:15px; border-radius:8px; box-shadow:0 3px 8px rgba(0,0,0,0.1); }
  .cartRow { display: flex; justify-content: space-between; margin-bottom: 8px; }
  .totalRow { font-weight: bold; border-top:1px solid #ccc; padding-top:8px; }
  #paypal-buttons-container {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
    flex-wrap: wrap;
  }
</style>
</head>
<body>
<h2>uju & Co. PayPal Checkout</h2>
<div id="cartSummary"></div>
<div id="paypal-buttons-container"></div>

<!-- PayPal SDK with card funding enabled -->
<script src="https://www.paypal.com/sdk/js?client-id=AYMMP5tG5xhXOMwg9VwtF2SNXhO1txVUk2USwhWO9lcyrUAMwZbdKQSqj2ZwfIUUa44RaHxxrWryePnD&currency=USD&intent=CAPTURE&commit=true&enable-funding=card"></script>

<script>
// Parse items from query string
const params = new URLSearchParams(window.location.search);
const cartItems = {};
for (const [key, value] of params.entries()) {
  const parts = key.split('|');
  if (parts.length < 3) continue;
  const variantName = decodeURIComponent(parts[0]);
  const qty = parseInt(parts[1]);
  const price = parseFloat(parts[2]);
  if (!cartItems[variantName]) cartItems[variantName] = { qty: 0, price };
  cartItems[variantName].qty += qty;
}

// Render cart summary
function renderCartSummary() {
  const container = document.getElementById('cartSummary');
  let total = 0;
  let html = '';
  for (const name in cartItems) {
    const item = cartItems[name];
    const lineTotal = item.qty * item.price;
    total += lineTotal;
    html += `<div class="cartRow"><span>${name} x ${item.qty}</span><span>$${lineTotal.toFixed(2)}</span></div>`;
  }
  html += `<div class="cartRow totalRow"><span>Total</span><span>$${total.toFixed(2)}</span></div>`;
  container.innerHTML = html;
}
renderCartSummary();

// Render PayPal buttons
paypal.Buttons({
  style: { layout: 'horizontal', shape:'rect', color:'gold', label:'pay' },
  createOrder: function(data, actions) {
    return actions.order.create({
      purchase_units: [{
        amount: {
          currency_code: "USD",
          value: Object.values(cartItems).reduce((sum,it)=>sum+it.qty*it.price,0).toFixed(2),
          breakdown: {
            item_total: {
              currency_code: "USD",
              value: Object.values(cartItems).reduce((sum,it)=>sum+it.qty*it.price,0).toFixed(2)
            }
          }
        },
        items: Object.entries(cartItems).map(([name, it]) => ({
          name: name,
          unit_amount: { currency_code: "USD", value: it.price.toFixed(2) },
          quantity: it.qty
        }))
      }],
      application_context: {
        brand_name: "uju & Co.",
        user_action: "PAY_NOW",
        shipping_preference: "NO_SHIPPING"
      }
    });
  },
  onApprove: function(data, actions) {
    return actions.order.capture().then(function(details) {
      alert("Transaction completed by " + details.payer.name.given_name + "!");
    });
  },
  onError: function(err) {
    console.error(err);
    alert("Something went wrong with PayPal checkout.");
  }
}).render('#paypal-buttons-container');

</script>
</body>
</html>
