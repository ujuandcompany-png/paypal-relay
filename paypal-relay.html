<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PayPal Checkout</title>
<style>
  body {
    font-family: 'Dosis', sans-serif;
    max-width: 600px;
    margin: 40px auto;
    padding: 0 20px;
    text-align: center;
  }
  h2 {
    margin-bottom: 20px;
  }
  #cartSummary {
    text-align: left;
    margin-bottom: 20px;
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 15px;
  }
  .cartRow {
    display: flex;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .totalRow {
    font-weight: bold;
    border-top:1px solid #ccc;
    padding-top:8px;
  }

  /* Center PayPal button */
  #paypal-buttons-container {
    display: flex !important;
    justify-content: center !important;
    align-items: center;
    width: 100%;
    margin-top: 20px;
  }
  #paypal-buttons-container > div {
    margin-left: auto !important;
    margin-right: auto !important;
  }
</style>
</head>
<body>

<h2>PayPal Checkout</h2>
<div id="cartSummary"></div>
<div id="paypal-buttons-container"></div>

<script src="https://www.paypal.com/sdk/js?client-id=AYMMP5tG5xhXOMwg9VwtF2SNXhO1txVUk2USwhWO9lcyrUAMwZbdKQSqj2ZwfIUUa44RaHxxrWryePnD&currency=USD&intent=CAPTURE"></script>
<script>
  // Parse items from query string
  const params = new URLSearchParams(window.location.search);
  const cartItems = {};
  for (const [key, value] of params.entries()) {
    const parts = key.split('|');
    const name = decodeURIComponent(parts[0]);
    const qty = parseInt(parts[1]);
    const price = parseFloat(parts[2]);
    if (!cartItems[name]) cartItems[name] = { qty: 0, price };
    cartItems[name].qty += qty;
  }

  // Render cart summary
  const container = document.getElementById('cartSummary');
  let total = 0;
  let html = '';
  for (const name in cartItems) {
    const item = cartItems[name];
    const lineTotal = item.qty * item.price;
    total += lineTotal;
    html += `<div class="cartRow"><span>${name} x ${item.qty}</span><span>$${lineTotal.toFixed(2)}</span></div>`;
  }
  html += `<div class="cartRow totalRow"><span>Total</span><span>$${total.toFixed(2)}</span></div>`;
  container.innerHTML = html;

  // Render PayPal Buttons
  paypal.Buttons({
    style: { layout: 'horizontal', shape:'rect' },
    createOrder: function(data, actions) {
      return actions.order.create({
        purchase_units: [{
          amount: {
            currency_code: "USD",
            value: total.toFixed(2),
            breakdown: {
              item_total: {
                currency_code: "USD",
                value: total.toFixed(2)
              }
            }
          },
          items: Object.entries(cartItems).map(([name, it])=>({
            name: name,
            unit_amount: { currency_code: "USD", value: it.price.toFixed(2) },
            quantity: it.qty
          }))
        }],
        application_context: {
          brand_name: "uju & Co.",
          user_action: "PAY_NOW",
          shipping_preference: "NO_SHIPPING"
        }
      });
    },
    onApprove: function(data, actions) {
      return actions.order.capture().then(function(details) {
        alert("Transaction completed by " + details.payer.name.given_name + "!");
      });
    }
  }).render('#paypal-buttons-container');
</script>

</body>
</html>
