<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>uju & Co. PayPal Checkout</title>
<script src="https://www.paypal.com/sdk/js?client-id=AYMMP5tG5xhXOMwg9VwtF2SNXhO1txVUk2USwhWO9lcyrUAMwZbdKQSqj2ZwfIUUa44RaHxxrWryePnD&currency=USD"></script>
<style>
body { font-family: Arial, sans-serif; text-align: center; padding: 40px; }
h1 { font-size: 28px; margin-bottom: 20px; }
.cartItem { margin-bottom: 10px; font-size: 18px; }
</style>
</head>
<body>

<h1>uju & Co. PayPal Checkout</h1>
<div id="cartItems"></div>
<div id="paypal-button-container" style="margin-top:30px;"></div>

<script>
// Parse cart from URL parameters
const urlParams = new URLSearchParams(window.location.search);
const cart = [];

const itemNames = urlParams.getAll("item_name");
const amounts = urlParams.getAll("amount");
const quantities = urlParams.getAll("quantity");
const hostedIDs = urlParams.getAll("hosted_button_id");
const options = urlParams.getAll("os0"); // color/variant

for(let i=0;i<itemNames.length;i++){
    cart.push({
        name: itemNames[i] + (options[i] ? " â€“ "+options[i] : ""),
        unit_amount: { currency_code: "USD", value: amounts[i] },
        quantity: quantities[i],
        hosted_button_id: hostedIDs[i]
    });
}

// Show items in the relay page
const cartDiv = document.getElementById("cartItems");
if(cart.length===0){
    cartDiv.innerHTML="<p>Your cart is empty.</p>";
}else{
    cart.forEach(item=>{
        const div = document.createElement("div");
        div.className="cartItem";
        div.textContent=`${item.name} x ${item.quantity} ($${item.unit_amount.value})`;
        cartDiv.appendChild(div);
    });
}

// Render PayPal Buttons
paypal.Buttons({
    style: { layout: 'vertical', color: 'blue', shape: 'rect', label: 'checkout' },
    createOrder: function(data, actions) {
        return actions.order.create({
            purchase_units: [{
                amount: {
                    currency_code: "USD",
                    value: cart.reduce((sum,item)=>sum + item.unit_amount.value*item.quantity,0).toFixed(2),
                    breakdown: {
                        item_total: {
                            currency_code: "USD",
                            value: cart.reduce((sum,item)=>sum + item.unit_amount.value*item.quantity,0).toFixed(2)
                        }
                    }
                },
                items: cart.map(item=>({
                    name: item.name,
                    unit_amount: item.unit_amount,
                    quantity: item.quantity
                }))
            }],
            application_context: {
                brand_name: "uju & Co.",
                shipping_preference: "NO_SHIPPING"
            }
        });
    },
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
            alert('Transaction completed by ' + details.payer.name.given_name + '!');
            window.close(); // Optional: close the relay page after payment
        });
    },
    onError: function(err){
        console.error(err);
        alert("An error occurred during checkout. Please try again.");
    }
}).render('#paypal-button-container');
</script>

</body>
</html>
